<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport"/><link rel="icon" href="/favicon.png" type="image/png"/><title>GraphQL Firebase</title><meta content="The easiest, fastest, and most flexible way to add a GraphQL server to your Firebase Functions. Complete with mocking, playgrounds, GraphQL Voyager, and Firebase Hosting integration for a custom url." name="description"/><meta name="next-head-count" content="5"/><link rel="preload" href="/graphql-firebase/_next/static/css/0f63b1889cd5ef8ceb09.css" as="style"/><link rel="stylesheet" href="/graphql-firebase/_next/static/css/0f63b1889cd5ef8ceb09.css" data-n-g=""/><noscript data-n-css=""></noscript><link rel="preload" href="/graphql-firebase/_next/static/chunks/main-038f0ad25f6c94d56cb6.js" as="script"/><link rel="preload" href="/graphql-firebase/_next/static/chunks/webpack-95c2b224bccf352ee870.js" as="script"/><link rel="preload" href="/graphql-firebase/_next/static/chunks/framework.017c4b60e3e1f640722e.js" as="script"/><link rel="preload" href="/graphql-firebase/_next/static/chunks/31664189.14c810a99516a2889994.js" as="script"/><link rel="preload" href="/graphql-firebase/_next/static/chunks/d3071e6a.6de1b3e704db25d01376.js" as="script"/><link rel="preload" href="/graphql-firebase/_next/static/chunks/09875f0d519b869f04a180ec93651cbe4028bec0.08f60211de5ae67cc683.js" as="script"/><link rel="preload" href="/graphql-firebase/_next/static/chunks/pages/_app-09fe1f8271823d2bd292.js" as="script"/><link rel="preload" href="/graphql-firebase/_next/static/chunks/pages/options/middleware-b7026fb8e8d1b1990fde.js" as="script"/></head><body><div id="__next"><nav class="navbar navbar-expand-lg navbar-dark bg-dark"><a class="navbar-brand" href="/graphql-firebase">GraphQL Firebase</a><button aria-controls="navbar" type="button" aria-label="Toggle navigation" class="navbar-toggler collapsed"><span class="navbar-toggler-icon"></span></button><div class="navbar-collapse collapse" id="navbar"><div class="mr-auto navbar-nav"><a class="nav-link" href="/graphql-firebase/features">Features</a><a class="nav-link" href="/graphql-firebase/installation">Getting Started</a><a class="nav-link" href="/graphql-firebase/options">Options</a><a class="nav-link" href="/graphql-firebase/firebase-hosting">Custom URL</a></div><div class="navbar-nav"><a href="https://github.com/undefinedai/graphql-firebase" data-rb-event-key="https://github.com/undefinedai/graphql-firebase" class="nav-link"><svg stroke="currentColor" fill="currentColor" stroke-width="0" version="1.1" viewBox="0 0 16 16" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M8 0.198c-4.418 0-8 3.582-8 8 0 3.535 2.292 6.533 5.471 7.591 0.4 0.074 0.547-0.174 0.547-0.385 0-0.191-0.008-0.821-0.011-1.489-2.226 0.484-2.695-0.944-2.695-0.944-0.364-0.925-0.888-1.171-0.888-1.171-0.726-0.497 0.055-0.486 0.055-0.486 0.803 0.056 1.226 0.824 1.226 0.824 0.714 1.223 1.872 0.869 2.328 0.665 0.072-0.517 0.279-0.87 0.508-1.070-1.777-0.202-3.645-0.888-3.645-3.954 0-0.873 0.313-1.587 0.824-2.147-0.083-0.202-0.357-1.015 0.077-2.117 0 0 0.672-0.215 2.201 0.82 0.638-0.177 1.322-0.266 2.002-0.269 0.68 0.003 1.365 0.092 2.004 0.269 1.527-1.035 2.198-0.82 2.198-0.82 0.435 1.102 0.162 1.916 0.079 2.117 0.513 0.56 0.823 1.274 0.823 2.147 0 3.073-1.872 3.749-3.653 3.947 0.287 0.248 0.543 0.735 0.543 1.481 0 1.070-0.009 1.932-0.009 2.195 0 0.213 0.144 0.462 0.55 0.384 3.177-1.059 5.466-4.057 5.466-7.59 0-4.418-3.582-8-8-8z"></path></svg></a><a href="https://www.npmjs.com/package/@undefinedai/graphql-firebase" data-rb-event-key="https://www.npmjs.com/package/@undefinedai/graphql-firebase" class="nav-link"><svg stroke="currentColor" fill="currentColor" stroke-width="0" version="1.1" viewBox="0 0 16 16" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M0 0v16h16v-16h-16zM13 13h-2v-8h-3v8h-5v-10h10v10z"></path></svg></a></div></div></nav><div class="jumbotron"><div class="container"><div class="row"><div class="col-lg-8 offset-lg-2"><h1 class="display-4">Global and Specific Middleware</h1><p class="lead"><a href="/graphql-firebase/options">← Back to all options</a></p></div></div></div></div><main class="container"><div class="row"><div class="col-lg-8 offset-lg-2"><p>With GraphQL Firebase, you have middlewares galore. Let’s start with the <code>globalMiddleware</code> option.</p><h2>Using <code>globalMiddleware</code></h2><p>With this option, you can add any<!-- --> <a href="https://expressjs.com/en/guide/using-middleware.html">Express middleware</a> <!-- -->to your GraphQL Firebase. Adding middleware here will apply to<!-- --> <em>all</em> of your endpoints. This might be a good place to, for example, add some analytics if you want to log every request that comes no matter what the request is (graphql, mockql, playground, voyager - whatever).</p><p>You can pass a single middleware function, or an array of functions. If passing an array, your <code>globalMiddleware</code> <!-- -->will run in order before any other middleware and before any of the GraphQL Firebase responses are handled.</p><pre class="bg-light p-3"><code><span class="text-muted">// We use ES6+ and typescript in our projects,<br/>// but you can adjust this to use commonjs</span><br/><br/>import * as functions from &quot;firebase-functions&quot;

import { GraphQLFirebase } from &quot;@undefinedai/graphql-firebase&quot;

const loggingMiddleware = (req: express.Request, res: express.Response, next: express.NextFunction) =&gt; {
  console.log(&quot;Time:&quot;, Date.now())
  next()
}

export const graphql = functions.https.onRequest(GraphQLFirebase({ 
  globalMiddleware: loggingMiddleware
}))</code></pre><h2>Using Path-Specific Middleware</h2><p>For each &quot;path&quot; created by GraphQL Firebase, you can pass any custom middleware and have it applied just to that path. With everything enabled, GraphQL Firebase has the following middleware options for the following paths:</p><dl class="row"><dt class="col-md-5 col-xl-4"><code>dashboardMiddleware</code></dt><dd class="col-md-7 col-xl-8">Runs just before a user accesses the dashboard page</dd><dt class="col-md-5 col-xl-4"><code>fourOhFourMiddleware</code></dt><dd class="col-md-7 col-xl-8">Runs just before serving up the GraphQL Firebase 404 page</dd><dt class="col-md-5 col-xl-4"><code>graphMiddleware</code></dt><dd class="col-md-7 col-xl-8">Runs just before processing any requests to the<!-- --> <code>graphql</code> endpoint</dd><dt class="col-md-5 col-xl-4"><code>graphPlaygroundMiddleware</code></dt><dd class="col-md-7 col-xl-8">Runs just before a user accesses the GraphQL Playground</dd><dt class="col-md-5 col-xl-4"><code>mockMiddleware</code></dt><dd class="col-md-7 col-xl-8">Runs just before processing any requests to the<!-- --> <code>mockql</code> endpoint</dd><dt class="col-md-5 col-xl-4"><code>mockPlaygroundMiddleware</code></dt><dd class="col-md-7 col-xl-8">Runs just before a user accesses the MockQL Playground</dd><dt class="col-md-5 col-xl-4"><code>voyagerMiddleware</code></dt><dd class="col-md-7 col-xl-8">Runs just before a user accesses the GraphQL Voyager</dd></dl><h3 id="verify-request-headers">Example: Verifying Headers For Requests</h3><p>Let’s say you use Firebase Authentication in your app and you want to verify a user’s<!-- --> <a href="https://firebase.google.com/docs/auth/admin/verify-id-tokens">Firebase ID Token</a> <!-- -->as a way of authenticating graphql requests so that other apps can’t use your api. Your app passes the <code>idToken</code> <!-- -->as a header named <code>X-Token</code>. We’re going to apply this same requirement to the graphql and mockql endpoints:</p><pre class="bg-light p-3"><code><span class="text-muted">// We use ES6+ and typescript in our projects,<br/>// but you can adjust this to use commonjs</span><br/><br/>import * as functions from &quot;firebase-functions&quot;
import * as admin from &quot;firebase-admin&quot;

import { GraphQLFirebase } from &quot;@undefinedai/graphql-firebase&quot;

const authMiddleware = async (req: express.Request, res: express.Response, next: express.NextFunction) =&gt; {
  const idToken = req.get(&quot;X-Token&quot;) || &quot;badToken&quot;
  try {
    await admin.auth().verifyIdToken(idToken)
    next()
  } catch (error) {
    res.json({
      error: {
        errors: [
          {
            code: 401,
            message: &quot;The credentials you supplied could not be verified.&quot;,
          },
        ],
      },
    })
    res.end()
  }
}

export const graphql = functions.https.onRequest(GraphQLFirebase({ 
  graphMiddleware: authMiddleware,
  mockMiddleware: authMiddleware
}))</code></pre><p>Notice two key things here:</p><ol><li>Middleware functions can return promises and use<!-- --> <code>async<span class="text-muted">/</span>await</code>.</li><li>We’re sending json back to be consumed by our app – this is not required. You can do whatever you like in the<!-- --> <code>catch</code> block.</li></ol><p>You should also note that this middleware would essentially &quot;break&quot; your playgrounds and voyager because the playgrounds and voyager need to communicate with your endpoints. We say &quot;break&quot; in quotes because<!-- --> <a href="/graphql-firebase/options/headers">there’s a &quot;fix&quot; for it</a>.</p><p><a href="/graphql-firebase/options">← Back to all options</a></p></div></div></main><div class="my-5 mx-auto text-center" style="max-width:540px"><hr/><small class="text-muted">Docs updated<!-- --> <!-- -->December 29, 2020, 1:17:30 AM UTC</small></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/options/middleware","query":{},"buildId":"x_jLAqNvoVeCQHPOaVttD","assetPrefix":"/graphql-firebase","nextExport":true,"autoExport":true,"isFallback":false}</script><script nomodule="" src="/graphql-firebase/_next/static/chunks/polyfills-088f2db4a64647850150.js"></script><script src="/graphql-firebase/_next/static/chunks/main-038f0ad25f6c94d56cb6.js" async=""></script><script src="/graphql-firebase/_next/static/chunks/webpack-95c2b224bccf352ee870.js" async=""></script><script src="/graphql-firebase/_next/static/chunks/framework.017c4b60e3e1f640722e.js" async=""></script><script src="/graphql-firebase/_next/static/chunks/31664189.14c810a99516a2889994.js" async=""></script><script src="/graphql-firebase/_next/static/chunks/d3071e6a.6de1b3e704db25d01376.js" async=""></script><script src="/graphql-firebase/_next/static/chunks/09875f0d519b869f04a180ec93651cbe4028bec0.08f60211de5ae67cc683.js" async=""></script><script src="/graphql-firebase/_next/static/chunks/pages/_app-09fe1f8271823d2bd292.js" async=""></script><script src="/graphql-firebase/_next/static/chunks/pages/options/middleware-b7026fb8e8d1b1990fde.js" async=""></script><script src="/graphql-firebase/_next/static/x_jLAqNvoVeCQHPOaVttD/_buildManifest.js" async=""></script><script src="/graphql-firebase/_next/static/x_jLAqNvoVeCQHPOaVttD/_ssgManifest.js" async=""></script></body></html>